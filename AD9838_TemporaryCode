#include <stdint.h>
#include <stdbool.h>
#include "inc/hw_ints.h"
#include "inc/hw_memmap.h"
#include "inc/hw_types.h"
#include "inc/hw_pwm.h"
#include "driverlib/gpio.h"
#include "driverlib/interrupt.h"
#include "driverlib/sysctl.h"
#include "driverlib/systick.h"
#include "driverlib/ssi.h"
#include "driverlib/timer.h"
#include "driverlib/pin_map.h"
#include "driverlib/pwm.h"
#include "driverlib/timer.h"

void main()
{
	uint32_t dataval1=0x4001, dataval2 = 0x8002;
	SysCtlClockFreqSet(SYSCTL_XTAL_25MHZ| SYSCTL_USE_PLL | SYSCTL_OSC_MAIN | SYSCTL_CFG_VCO_480, 120000000);

	SysCtlPWMClockSet(SYSCTL_PWMDIV_2);
	SysCtlPeripheralEnable(SYSCTL_PERIPH_PWM0);
	SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOK);

	GPIOPinConfigure(GPIO_PK4_M0PWM6);

	GPIOPinTypePWM(GPIO_PORTK_BASE, GPIO_PIN_4);

	PWMGenConfigure(PWM0_BASE, PWM_GEN_3, PWM_GEN_MODE_DOWN|PWM_GEN_MODE_NO_SYNC);

	PWMGenPeriodSet(PWM0_BASE, PWM_GEN_3, 8);
	PWMPulseWidthSet(PWM0_BASE, PWM_OUT_6, 3);

	PWMOutputState(PWM0_BASE, PWM_OUT_6_BIT, true);

	PWMGenEnable(PWM0_BASE, PWM_GEN_3);

	SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOM);
	SysCtlPeripheralEnable(SYSCTL_PERIPH_TIMER5);

	GPIOPinConfigure(GPIO_PM7_T5CCP1);
	GPIOPinTypeTimer(GPIO_PORTM_BASE, GPIO_PIN_7);

	TimerConfigure(TIMER5_BASE, TIMER_CFG_SPLIT_PAIR|TIMER_CFG_B_PWM);
	TimerLoadSet(TIMER5_BASE, TIMER_B, 10);

	TimerMatchSet(TIMER5_BASE, TIMER_B, 5);
	TimerEnable(TIMER5_BASE, TIMER_B);

	SysCtlPeripheralEnable(SYSCTL_PERIPH_SSI3);
		int x = SYSCTL_PERIPH_SSI0;
		SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOQ);

		GPIOPinTypeSSI(GPIO_PORTQ_BASE, GPIO_PIN_0|GPIO_PIN_1|GPIO_PIN_2);

		GPIOPadConfigSet(GPIO_PORTQ_BASE, GPIO_PIN_0, GPIO_STRENGTH_4MA, GPIO_PIN_TYPE_STD_WPU);
		GPIOPadConfigSet(GPIO_PORTQ_BASE, GPIO_PIN_1|GPIO_PIN_2, GPIO_STRENGTH_4MA, GPIO_PIN_TYPE_STD);

		GPIOPinConfigure(GPIO_PQ0_SSI3CLK);
		GPIOPinConfigure(GPIO_PQ1_SSI3FSS);
		GPIOPinConfigure(GPIO_PQ2_SSI3XDAT0);

		SSIConfigSetExpClk(SSI3_BASE, 25000000, SSI_FRF_MOTO_MODE_2, SSI_MODE_MASTER, 500000, 16);
		SSIEnable(SSI3_BASE);

		SSIDataPut(SSI3_BASE, 0x2108);
		SSIDataPut(SSI3_BASE, 0x53E3);
		SSIDataPut(SSI3_BASE, dataval1);
		SSIDataPut(SSI3_BASE, 0xC000);
		SSIDataPut(SSI3_BASE, 0x2000);

		SysCtlDelay(SysCtlClockGet()/10);

		while (1)
		{

			SSIDataPut(SSI3_BASE, 0x2808);
			SSIDataPut(SSI3_BASE, 0x93E3);
			SSIDataPut(SSI3_BASE, dataval2);
			SSIDataPut(SSI3_BASE, 0xC000);

			SysCtlDelay(SysCtlClockGet()/10);

			SSIDataPut(SSI3_BASE, 0x2008);
			SSIDataPut(SSI3_BASE, 0x53E3);
			SSIDataPut(SSI3_BASE, dataval1);
			SSIDataPut(SSI3_BASE, 0xC000);
			SysCtlDelay(SysCtlClockGet()/10);

			dataval1+= 0x0002;
			dataval2+= 0x0002;

			if ((dataval1 >= 0x7FFE) || (dataval2 == 0xBFFE))
			{
				dataval1 = 0x4001;
				dataval2 = 0x8002;
			}
		}
}

